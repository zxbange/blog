---
layout: post
title:  "MySQL数字类型的坑"
subtitle: "介绍常见MySQL数字类型容易触发的坑"
date:   2021-07-13 16:31:29 +0900
categories: MySQL
author:  "张鑫"
tags:
  - 数字类型
---

# 数字类型

### 整形类型

| 类型 | 占用空间 | 最小值~最大值[signed] | 最小值~最大值[unsigned] |
| --- | --- | --- | --- |
| tinyint | 1 | -128 ~ 127 | 0 ~ 255 |
| smallint | 2 | -32768 ~ 32767 | 0 ~ 65535 |
| mediumint | 3 | -8388608 ~ 8388607 | 0 ~ 1677215 |
| int | 4 | -2147483648 ~ 2147483647 | 0 ~ 4294967295 |
| biging | 8 | -9223372036854775808 ~ 9223372036854775807 | 0 ~ 18446744073709551615 |

数据类型默认是signed，不建议使用unsigned。unsigned数值相减之间依然是unsigned，但是如果不是unsigned，就会报错。为了避免这个错误，需要对数据库参数 sql_mode 设置为 NO_UNSIGNED_SUBTRACTION，允许相减的结果为 signed。

### 浮点型和高精度型

不建议使用float和Double类型，不是高精度，也不是SQL标准。由于精度类型问题，可能导致最终计算结果出错。

在mysql 8.0.17开始创建float或Double时，会出现警告。

DECIMAL类型可以使用，但在海量业务下，也不推荐使用DECIMAL，而是推荐使用INT。

### 资金字段设计
不使用DECIMAL，而是用整型类型（BIGINT），单位为分

DECIMAL好处是用户余额等金额字段可精确到分，但是：
* 无法正确定义长度，字段是非定长；
* 类型 DECIMAL 是通过二进制实现的一种编码方式，计算效率远不如整型来的高效。

使用BIGINT好处：
* 所有金额相关字段都是定长字段，占用 8 个字节，存储高效。
* 另一点，直接通过整型计算，效率更高。

定长字段的好处是减少数据页的碎片。

### 思考
除了DECIMAL字段可以用整型，还有哪些字段可以用？

IP字段。